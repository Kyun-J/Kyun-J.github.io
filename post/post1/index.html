<!DOCTYPE html>
<html lang="ko-kr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://kyun-j.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://kyun-j.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://kyun-j.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://kyun-j.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://kyun-j.github.io/css/light.css' />
    <link rel="stylesheet" href='https://kyun-j.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://kyun-j.github.io/css/syntax.css' />
    <title>(Flutter) Model을 베이스로 한 http통신을 구성해 보자 - dvkyun blog</title>
    
    <link rel="icon" type="image/x-icon" href='/images/github.png'>
    
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="(Flutter) Model을 베이스로 한 http통신을 구성해 보자" />
<meta name="keywords"
  content='blog, google analytics' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://kyun-j.github.io/post/post1/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="(Flutter) Model을 베이스로 한 http통신을 구성해 보자 - dvkyun blog" />
<meta name="twitter:description"
  content="(Flutter) Model을 베이스로 한 http통신을 구성해 보자" />
<meta name="twitter:site" content="https://kyun-j.github.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://kyun-j.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="(Flutter) Model을 베이스로 한 http통신을 구성해 보자 - dvkyun blog">
<meta property="og:description"
  content="(Flutter) Model을 베이스로 한 http통신을 구성해 보자" />
<meta property="og:url" content="https://kyun-j.github.io/post/post1/" />
<meta property="og:site_name" content="(Flutter) Model을 베이스로 한 http통신을 구성해 보자" />
<meta property="og:image"
  content="https://kyun-j.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2021-03-15 13:15:51 &#43;0900 KST" />










</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://kyun-j.github.io/">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://kyun-j.github.io/">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://kyun-j.github.io/">
        <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
          width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://kyun-j.github.io/">
                  <img class=" avatar-user"
                    src="/images/17011240.jpg"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://kyun-j.github.io/">dvkyun</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://kyun-j.github.io/post/post1/">(Flutter) Model을 베이스로 한 http통신을 구성해 보자</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Mon, 15 Mar 2021 13:15:51 &#43;0900"
                    class="no-wrap">
                    Mon, 15 Mar 2021 13:15:51 &#43;0900</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Tue, 16 Mar 2021 09:42:46 &#43;0900"
                    class="no-wrap">
                    Tue, 16 Mar 2021 09:42:46 &#43;0900</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div class="file-header d-flex flex-md-items-center flex-items-start">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    1829 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5">
                <article class="markdown-body entry-content container-lg"><h1 id="flutter의-http통신을-아름답게-사용-할-수-없을까">Flutter의 http통신을 아름답게 사용 할 수 없을까?</h1>
<blockquote>
<p>Retroift같이 Model을 베이스로 한 통신을 구성 할 수 없을까?<br>
자연스러운 비동기 통신을 구성 할 순 없을까?<br>
서드파티 라이브러리를 사용하지 않고, 기본 기능과 문법으로 구성해 볼 수 있지 않을까?</p>
</blockquote>
<p>Flutter를 사용하다보니 이와 같은 생각이 들었다.<br>
Dart의 아래 특징을 사용하면 충분히 가능할거란 판단이 들어 시도를 해 보았다.</p>
<ol>
<li><strong>Generic</strong>이 있다. (즉, 타입 체크 및 Model만의 공통 기능 사용이 가능하다.)</li>
<li><strong>factory</strong>를 통해 Constructor를 커스텀 할 수 있다.</li>
<li>json(String)을 Map으로 Convert할 수 있는 기능이 있다.</li>
<li>비동기 작업을 위한 기능(<strong>Future</strong>)가 있다.</li>
</ol>
<h2 id="기본-model클래스-생성">기본 Model클래스 생성</h2>
<p>모든 Model객체의 부모가 될 Model 클래스를 생성하자.</p>
<div class="highlight"><pre class="chroma"><code class="language-dart" data-lang="dart"><span class="kd">class</span> <span class="nc">Model</span> <span class="p">{}</span>
</code></pre></div><p>Model클래스는 일단 아무런 기능이 필요 없다. 모든 Model객체는 Model클래스를 extends 할 것이고, 이를 통해 1차 타입 체크를 할 것이다.<br>
추가로, 모든 Model객체들에게 공통적인 기능이 필요하다면 해당 클래스에 구현하면 된다.</p>
<h3 id="서버로부터-기본공통적인-정보를-저장할-res-클래스">서버로부터 기본(공통)적인 정보를 저장할 Res 클래스</h3>
<p>서버로부터 단순히 요청의 데이터만 받는 경우는 드물다.<br>
응답코드, 응답메시지, 에러코드 등 여러 추가적인 정보를 포함 할 Res 클래스를 생성하자.<br>
<script type="application/javascript" src="https://gist.github.com/Kyun-J/e4323ad4c85a3a06888c54e8449addea.js?file=res.dart"></script>

이때, 서버로부터 전달 받을 데이터를 Model객체로 하며 Generic을 통해 원하는 모델을 전달받고 타입 검증을 할 수 있도록 구성하자.</p>
<h3 id="실제-사용할-model클래스-생성">실제 사용할 Model클래스 생성</h3>
<p>실제 데이터를 포함할 간단한 Model을 생성하자.
<script type="application/javascript" src="https://gist.github.com/Kyun-J/e4323ad4c85a3a06888c54e8449addea.js?file=user.dart"></script>

factory를 통해 fromJson 생성자를 만들고, Map을 전달하면 자동으로 클래스를 생성하도록 구성하자.<br>
또한 새로운 Model 클래스를 구성할 때 factory fromJson을 통해 Map으로 객체를 생성하도록 하자.</p>
<h3 id="map을-특정-model로-변환">Map을 특정 Model로 변환</h3>
<p>각 Model의 fromJson을 호출하여 Map을 Model로 변환할 함수를 하나 만들도록 하자.
<script type="application/javascript" src="https://gist.github.com/Kyun-J/e4323ad4c85a3a06888c54e8449addea.js?file=toSpecificModel.dart"></script>

위 함수는 아래와 같이 사용할 수 있을 것 이다.</p>
<div class="highlight"><pre class="chroma"><code class="language-dart" data-lang="dart"><span class="n">User</span> <span class="n">myUser</span> <span class="o">=</span> <span class="n">toSpecificModel</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="p">(</span><span class="n">jsonMap</span><span class="p">);</span>
</code></pre></div><h2 id="http-통신하여-model에-담기">http 통신하여 Model에 담기</h2>
<p>이제 본격적으로 http통신을 하여 Model로 받아보도록 하자.<br>
먼저 기본적으로 다음의 라이브러리가 필요하다.<br>
(Dart 개발 팀 공식 라이브러리)</p>
<div class="highlight"><pre class="chroma"><code class="language-dart" data-lang="dart"><span class="k">import</span> <span class="s1">&#39;package:http/http.dart&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">&#39;dart:convert&#39;</span><span class="p">;</span>
</code></pre></div><p>위 라이브러리를 추가하면 <code>Client()</code>함수로 http Client객체를 생성할 수 있고, <code>json.decode(String resource)</code>함수를 통해 Json형태의 String을 Map으로 변환할 수 있다.<br>
<strong>(http.dart의 response body는 byte 혹은 String으로만 전달 받을 수 있기 때문.)</strong><br>
그 후 Api클래스를 아래와 같이 구성하자.
<script type="application/javascript" src="https://gist.github.com/Kyun-J/e4323ad4c85a3a06888c54e8449addea.js?file=Api.dart"></script>
</p>
<h3 id="차근차근-뜯어보자">차근차근 뜯어보자</h3>
<p>Api클래스의 get 함수를 분석해보자.
<script type="application/javascript" src="https://gist.github.com/Kyun-J/e4323ad4c85a3a06888c54e8449addea.js?file=get.dart"></script>
</p>
<ol>
<li>client 객체의 리턴은 비동기(Future)를 통해 전달된다.
<ol>
<li>따라서 get 함수 또한, async await를 구성하고 Future를 리턴하도록 구성.</li>
</ol>
</li>
<li>Future는 특정 Model을 담은 Res객체를 반환하도록 구성.</li>
<li>공통 함수(_genRes, _genUri, genDefaultHeaders) 생성
<ol>
<li>기타 http 및 Rest Method(delete, post, put &hellip;)에서도 공통적으로 사용할 기능이기에 분리</li>
</ol>
</li>
</ol>
<h3 id="genres">genRes</h3>
<p>genRes함수에는 중요 기능들이 포함되어 있다.
<script type="application/javascript" src="https://gist.github.com/Kyun-J/e4323ad4c85a3a06888c54e8449addea.js?file=_genRes.dart"></script>

json.decode를 통해 response의 body를 Map으로 변환 후, 먼저 선언하였던 toSepcificModel 함수를 통해 원하는 Model로 Map을 변환하여 최종적으로 Model이 포함된 결과값을 받게 된다!</p>
<h3 id="정리하면"><strong>정리하면&hellip;</strong></h3>
<p>현재까지 진행사항을 통해, 아래와 같이 http통신을 하고 User Model을 결과값으로 전달 받을 수 있다.
<script type="application/javascript" src="https://gist.github.com/Kyun-J/e4323ad4c85a3a06888c54e8449addea.js?file=apiUse.dart"></script>
</p>
<h2 id="하지만-아직-부족하다"><strong>하지만 아직 부족하다!</strong></h2>
<p>여기까지 진행해도 Model을 사용한 통신 구성에 문제는 없지만, Dart의 <code>mixin</code>을 활용하여 좀 더 고급스럽게 사용해 보자.</p>
<h3 id="mixin-클래스-생성">mixin 클래스 생성</h3>
<p><script type="application/javascript" src="https://gist.github.com/Kyun-J/e4323ad4c85a3a06888c54e8449addea.js?file=UserApi.dart"></script>

먼저, Res<!-- raw HTML omitted --> 객체가 아닌 <code>Model</code> 자체를 반환받도록 한번 더 함수로 감싸자.<br>
그리고 <code>mixin</code>이기 때문에, 아래와 같이 실 사용이 가능하다.</p>
<h3 id="최종-결과">최종 결과</h3>
<p><script type="application/javascript" src="https://gist.github.com/Kyun-J/e4323ad4c85a3a06888c54e8449addea.js?file=final.dart"></script>

상태 변경에따라 Widget을 빌드하는 클래스인 _MyHomePageState 클래스에 <code>with UserApi</code>를 추가하여, UserApi mixin에 선언한 함수를 바로 사용 할 수 있게 되었다.<br>
이제 _addUser()를 호출할 때마다 리스트에 새로운 <code>User Model</code>이 <em><strong>서버와의 통신을 통해</strong></em> 추가되고, 이를 활용해 여러 작업(리스트를 추가한다던지&hellip;)이 가능할 것이다!</p>
<h2 id="마무리">마무리&hellip;</h2>
<p>Retrofit과 유사하게 http 통신을 하도록 구성해 보았습니다.<br>
이 포스트에는 응답 부분만 다루었지만, 조금만 수정하면 <strong>Request도 충분히 Model을 통해</strong> 사용할 수 있을 것입니다.<br>
아직 flutter를 공부하는 단계여서 미흡한 부분이 많습니다 너그럽게 봐주시면 감사드립니다 ^^.<br>
다음에는 Flutter Web(WebView가 아닌 Web)의 웹페이지와 인터페이스 하는 방법을 다뤄보도록 하겠습니다.</p>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://kyun-j.github.io/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://kyun-j.github.io/js/github-style.js"></script>



</html>